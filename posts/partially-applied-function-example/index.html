<!doctype html><html lang=en><head><title>Partially-applied function. A `practical` example. · Bruno Hensel</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Bruno Hensel"><meta name=description content="Partial application Link to heading In computer science, partial application (or partial function application) refers to the process of fixing a number of arguments of a function, producing another function of smaller arity. Source
The way I see it, this is a function in which the final result is computed at different time:
// Example from the Functional Programming with Kotlin book fun <A, B, C> partial1(a: A, f: (A, B) -> C): (B) -> C = { b -> f(a, b) } In this case, we call a function passing in as arguments a a:A value and a function from (A, B) to C, producing another function from B to C."><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Partially-applied function. A `practical` example."><meta name=twitter:description content="Partial application Link to heading In computer science, partial application (or partial function application) refers to the process of fixing a number of arguments of a function, producing another function of smaller arity. Source
The way I see it, this is a function in which the final result is computed at different time:
// Example from the Functional Programming with Kotlin book fun <A, B, C> partial1(a: A, f: (A, B) -> C): (B) -> C = { b -> f(a, b) } In this case, we call a function passing in as arguments a a:A value and a function from (A, B) to C, producing another function from B to C."><meta property="og:title" content="Partially-applied function. A `practical` example."><meta property="og:description" content="Partial application Link to heading In computer science, partial application (or partial function application) refers to the process of fixing a number of arguments of a function, producing another function of smaller arity. Source
The way I see it, this is a function in which the final result is computed at different time:
// Example from the Functional Programming with Kotlin book fun <A, B, C> partial1(a: A, f: (A, B) -> C): (B) -> C = { b -> f(a, b) } In this case, we call a function passing in as arguments a a:A value and a function from (A, B) to C, producing another function from B to C."><meta property="og:type" content="article"><meta property="og:url" content="https://www.brunohensel.dev/posts/partially-applied-function-example/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-23T14:41:00+02:00"><meta property="article:modified_time" content="2023-12-23T14:41:00+02:00"><link rel=canonical href=https://www.brunohensel.dev/posts/partially-applied-function-example/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.e1bdf152d93b060b06ba5d496486ed9c201a8b95d335e035beb5faebe3b61cad.css integrity="sha256-4b3xUtk7BgsGul1JZIbtnCAai5XTNeA1vrX66+O2HK0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Bruno Hensel</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts>Blog</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.brunohensel.dev/posts/partially-applied-function-example/>Partially-applied function. A `practical` example.</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2023-12-23T14:41:00+02:00>Dec 23, 2023</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
5-minute read</span></div></div></header><div class=post-content><h2 id=partial-application>Partial application
<a class=heading-link href=#partial-application><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><blockquote><p>In computer science, partial application (or partial function application) refers to the process of fixing a number of arguments of a function, producing another function of smaller arity. <a href=https://en.wikipedia.org/wiki/Partial_application class=external-link target=_blank rel=noopener>Source</a></p></blockquote><p>The way I see it, this is a function in which the final result is computed at different time:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// Example from the Functional Programming with Kotlin book
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#ff7b72>fun</span> &lt;<span style=color:#f0883e;font-weight:700>A</span>, <span style=color:#f0883e;font-weight:700>B</span>, <span style=color:#f0883e;font-weight:700>C</span>&gt; <span style=color:#d2a8ff;font-weight:700>partial1</span>(a: A, f: (A, B) <span style=color:#ff7b72;font-weight:700>-&gt;</span> C): (B) <span style=color:#ff7b72;font-weight:700>-&gt;</span> C = { b <span style=color:#ff7b72;font-weight:700>-&gt;</span> f(a, b) }
</span></span></code></pre></div><p>In this case, we call a function passing in as arguments a <code>a:A</code> value and a function from (A, B) to C, producing another function from B to C.
In practice, and since there is only one way to implement it, when you call the returning function to produce C by passing the B argument, the <code>f</code> function gets called.</p><p>Example</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>    <span style=color:#ff7b72>val</span> <span style=color:#79c0ff>partialTenMultipliedBy</span> = partial1&lt;Int, Int, Int&gt;(a = <span style=color:#a5d6ff>10</span>, f = { a, b <span style=color:#ff7b72;font-weight:700>-&gt;</span> a * b } )
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>val</span> <span style=color:#79c0ff>double</span> = partialTenMultipliedBy(<span style=color:#a5d6ff>2</span>) <span style=color:#8b949e;font-style:italic>//yields 20
</span></span></span></code></pre></div><p>When you call <code>partialTenMultipliedBy</code> passing the number 2, this is the <code>B</code> argument of the <em>partial1</em> returning function. This results in the block <code>{ b -> }</code> being called, which also calls the <code>f(A, B)</code> function, finally returning <code>C</code>.</p><p>Having partially applied functions is possible because Kotlin allows functions to be passed in as arguments or returned by other functions. Such a way of doing it is known as <a href=https://kotlinlang.org/docs/lambdas.html#higher-order-functions class=external-link target=_blank rel=noopener>Higher-order functions</a>.
Below, we will see a practical usage of this technique.</p><p><strong>Note:</strong> As we will see below, this might incur a run-time overhead due to the creation of additional closures and anonymous functions.</p><h2 id=use-case>Use case
<a class=heading-link href=#use-case><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>I was working on one of my never-finished side projects to try out new technologies and one of the tasks I had to implement was to display images.
The Android App consumes the <a href=https://developer.themoviedb.org/ class=external-link target=_blank rel=noopener>TMDB</a> API. According to the documentation, you&rsquo;ll need three pieces of data to generate a fully working image URL: <code>base_url</code>, a <code>file_size</code> and a <code>file_path</code> (backdrop, logo, or poster).</p><p>We can retrieve the first two from the <code>/configuration</code> endpoint. However, we need to decide which <em>file_size</em> is more suitable for our component based on its size.
At the end, we need to have a URL that looks like this one: <em>image.tmdb.org/t/p/original/wwemzKWzjKYJFfCeiB57q3r4Bcm.svg</em>. <em>/original/</em> being the <em>file_size</em>. <a href=https://developer.themoviedb.org/docs/image-basics class=external-link target=_blank rel=noopener>Source</a></p><p>Currently, I have yet to implement any persistent solution (SQL, Room, or SharedPreferences), and left the URL construction to be made on the UI layer is error-prone, and we would be leaking information about what is needed to build a working image URL.</p><p>The network DTO would look like this:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#ff7b72>data</span> <span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>MovieDTO</span>(
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>val</span> <span style=color:#79c0ff>id</span>: Int,
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>val</span> <span style=color:#79c0ff>backdropPath</span>: String?, <span style=color:#8b949e;font-style:italic>// this nullable type comes from the API
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>val</span> <span style=color:#79c0ff>posterPath</span>: String?, <span style=color:#8b949e;font-style:italic>// this nullable type comes from the API
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>)
</span></span></code></pre></div><p>Since the information about <code>backdropPath</code> and <code>posterPath</code> alone is not that useful in the UI layer, they would be left out, and the UI model would look like this:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#ff7b72>data</span> <span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Movie</span>(
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>val</span> <span style=color:#79c0ff>id</span>: Int,
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>override</span> <span style=color:#ff7b72>inline</span> <span style=color:#ff7b72>val</span> <span style=color:#79c0ff>buildImgModel</span>: (type: ImageType) <span style=color:#ff7b72;font-weight:700>-&gt;</span> MovieImageModel?,
</span></span><span style=display:flex><span>) : ImageModelBuilder&lt;MovieImageModel&gt; 
</span></span></code></pre></div><p><code>ImageType</code> is just an enumeration class for <code>Backdrop|Poster</code>, <code>ImageModelBuilder</code> is an interface with a function of an image type to a <code>T</code>. <code>MovieImageModel</code> is just a data class containing path and image type information.</p><p>When we do the mapper between MovieDTO and Movie, we have a couple of options to fulfill the signature of the <code>buildImgModel</code>.</p><ul><li>pass a function with the same signature <code>(ImageType) -> MovieImageModel</code></li><li>construct the <code>MovieImageModel</code> directly</li><li>create a function to hold the paths&rsquo; information and return a function with the same signature needed</li></ul><p>Let&rsquo;s see what the third option looks like in the map function:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#ff7b72>suspend</span> <span style=color:#ff7b72>fun</span> <span style=color:#d2a8ff;font-weight:700>getMovies</span>() : List&lt;Movie&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>val</span> <span style=color:#79c0ff>moviesDTO</span> = someDependency.getMovies()
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> moviesDTO.map { dto <span style=color:#ff7b72;font-weight:700>-&gt;</span>
</span></span><span style=display:flex><span>        Movie(
</span></span><span style=display:flex><span>            id = dto.id,
</span></span><span style=display:flex><span>            buildImgModel = buildPartialMovieImageModel(dto.backdropPath, dto.posterPath),
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//Note: This is a closure, both backdropPath and posterPath are available within the body of the inner function.
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>private</span> <span style=color:#ff7b72>fun</span> <span style=color:#d2a8ff;font-weight:700>buildPartialMovieImageModel</span>(
</span></span><span style=display:flex><span>    backdropPath: String?,
</span></span><span style=display:flex><span>    posterPath: String?,
</span></span><span style=display:flex><span>) : (ImageType) <span style=color:#ff7b72;font-weight:700>-&gt;</span> MovieImageModel? = { type <span style=color:#ff7b72;font-weight:700>-&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>val</span> <span style=color:#79c0ff>path</span> = <span style=color:#ff7b72>when</span> (type) {
</span></span><span style=display:flex><span>        <span style=color:#f0883e;font-weight:700>ImageType</span>.Backdrop <span style=color:#ff7b72;font-weight:700>-&gt;</span> backdropPath
</span></span><span style=display:flex><span>        <span style=color:#f0883e;font-weight:700>ImageType</span>.Poster <span style=color:#ff7b72;font-weight:700>-&gt;</span> posterPath
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (path.isNullOrEmpty()) <span style=color:#ff7b72>null</span> <span style=color:#8b949e;font-style:italic>// for the brevity we&#39;re returning null, you could return a fallback ImageModel that displays local asset instead
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>else</span> MovieImageModel(path, type)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We partially apply the function, holding the paths&rsquo; information <em>in memory</em> waiting for the <code>type</code> information to be provided to create a fully formed <code>MovieImageModel</code> instance.
This is what we need; since the UI layer decides the type, this is the only information this layer is responsible for providing. So depending on the component the image will be rendered on, we can call <code>state.movie.buildImgModel(ImageType.Backdrop or ImageType.Poster)</code></p><p>The <em>file_size</em> most likely will depend on the size of the View component, it could either be passed together with the image type or the request could be intercepted and there we resolve the <em>file_size</em>.</p><p>That&rsquo;s it :)</p><p>With this, we create an <code>ImageModel</code> lazily by composing functions that partially apply their arguments at different levels of abstraction.
This technique not only can streamlines code but also empowers developers to construct dynamic and lazy compositions, as showcased in our image URL use case.</p><p>Resources</p><ul><li><a href=https://www.goodreads.com/book/show/49199400-functional-programming-in-kotlin class=external-link target=_blank rel=noopener>Functional Programming in Kotlin</a> p. 27</li></ul><p>Thanks to <a href=https://twitter.com/marcellogalhard class=external-link target=_blank rel=noopener>Marcello Galhardo</a> for reviewing the first draft.</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2024
Bruno Hensel
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ED4JJJVD8G"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ED4JJJVD8G")</script></body></html>